#!/bin/bash
#
# Install PostgreSQL 9.5 on Debian/Jessie

set -e

aptfile=/etc/apt/sources.list.d/pgdg.list
pgconf=/etc/postgresql/9.5/main/postgresql.conf

# Register PostgreSQL repo to APT
if [[ ! -f "$aptfile" ]]; then
  echo "deb http://apt.postgresql.org/pub/repos/apt/ jessie-pgdg main" \
    | sudo tee "$aptfile"
fi

# Register the signing key
if ! apt-key list | grep 4096R/ACCC4CF8 &> /dev/null ; then
  wget --quiet -O - https://www.postgresql.org/media/keys/ACCC4CF8.asc \
    | sudo apt-key add -
fi

# Install packages
sudo apt-get update
sudo apt-get install -y postgresql-9.5
sudo apt-get install -y postgresql-9.5-postgis-2.2

port=$(sed -n 's/^port *= *\([[:digit:]]\+\) *.*/\1/p' < $pgconf)

echo "PostgreSQL 9.5 is listening at port ${port}

To use version 9.5 of PostreSQL instead of 9.4, modify environment
variables as follows:

  (1) PATH=\"/usr/lib/postgresql/9.5/bin/:\$PATH\"
  (2) PGPORT=\"$port\"
"
